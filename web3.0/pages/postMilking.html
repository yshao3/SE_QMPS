<!DOCTYPE html>
<html lang="en">
<style>
#postcanvas {
  width: 100%;
  height: 500px;
}
</style>
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Post Milking Teat</title>

    <script src="../vendor/jquery/jquery.min.js"></script>

    <!-- D3-->
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <!-- Bootstrap Core CSS -->
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="../vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

    <!-- DataTables CSS -->
    <link href="../vendor/datatables-plugins/dataTables.bootstrap.css" rel="stylesheet">

    <!-- DataTables Responsive CSS -->
    <link href="../vendor/datatables-responsive/dataTables.responsive.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../dist/css/sb-admin-2.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <link rel='stylesheet prefeColorh' href='http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css'>
    <link rel='stylesheet prefeColorh' href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/3.1.3/css/bootstrap-datetimepicker.min.css'>
    <link rel='stylesheet prefeColorh' href='http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css'>


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- CDN chart js 2.7.2-->
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.js"></script>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js"></script>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>

    <!-- Resources -->
    <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
    <script src="https://www.amcharts.com/lib/3/serial.js"></script>
    <script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
    <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
    <script src="https://www.amcharts.com/lib/3/themes/light.js"></script>

    <style>

        table.blueTable {
        border: 1px solid #1C6EA4;
        background-color: #EEEEEE;
        width: 100%;
        text-align: left;
        border-collapse: collapse;
        }
        table.blueTable td, table.blueTable th {
        border: 1px solid #AAAAAA;
        padding: 3px 2px;
        }
        table.blueTable tbody td {
        font-size: 13px;
        }
        table.blueTable tr:nth-child(even) {
        background: #D0E4F5;
        }
        table.blueTable thead {
        background: #1C6EA4;
        background: -moz-linear-gradient(top, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
        background: -webkit-linear-gradient(top, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
        background: linear-gradient(to bottom, #5592bb 0%, #327cad 66%, #1C6EA4 100%);
        border-bottom: 2px solid #444444;
        }
        table.blueTable thead th {
        font-size: 15px;
        font-weight: bold;
        color: #FFFFFF;
        border-left: 2px solid #D0E4F5;
        text-align: center;
        }
        table.blueTable thead th:first-child {
        border-left: none;
        }

        table.blueTable tfoot {
        font-size: 14px;
        font-weight: bold;
        color: #FFFFFF;
        background: #D0E4F5;
        background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
        background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
        background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
        border-top: 2px solid #444444;
        }
        table.blueTable tfoot td {
        font-size: 14px;
        }
        table.blueTable tfoot .links {
        text-align: right;
        }
        table.blueTable tfoot .links a{
        display: inline-block;
        background: #1C6EA4;
        color: #FFFFFF;
        padding: 2px 8px;
        border-radius: 5px;
        }

    </style>

</head>

<body>

    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="dashboard.html">Quality Milk Production Services</a>
            </div>
            <!-- /.navbar-header -->

            <ul class="nav navbar-top-links navbar-right">
                <li class="dropdown">
                    <a onclick="logout()"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                </li>
            </ul>
            <!-- /.navbar-top-links -->

            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li>
                            <a href="dashboard.html"><i class="fa fa-dashboard fa-fw"></i> Dashboard</a>
                        </li>

                        <li>
                            <a href="teatCleaniness.html"><i class="fa fa-table fa-fw"></i> Teat Cleaniness</a>
                        </li>

                        <li>
                            <a href="unitAlignment.html"><i class="fa fa-cube fa-fw"></i> Unit Alignment</a>
                        </li>

                        <li>
                            <a href="udderHygiene.html"><i class="fa fa-file-text-o fa-fw"></i> Udder Hygiene</a>
                        </li>

                        <li>
                            <a href="stripYields.html"><i class="fa fa-shield fa-fw"></i> Strip Yields</a>
                        </li>

                        <li>
                            <a href="postMilking.html"><i class="fa fa-clipboard fa-fw"></i> Post Milking Teat</a>
                        </li>

                        <li>
                            <a href="lactoCoderRecord.html"><i class="fa fa-flask fa-fw"></i> LactoCoder Record</a>
                        </li>
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">Post Milking Teat Data Retrieve</h1>
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="container">
                    <div class="row">
                        <div class='col-sm-3'>
                            <div class="form-group">
                                    date From
                                <div class='input-group date' id='datetimepicker1'>
                                    <input id="date_1" type='text' class="form-control" />
                                    <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class='col-sm-3'>
                            <div class="form-group">
                                To:
                                <div class='input-group date' id='datetimepicker1'>
                                    <input  id="date_2" type='text' class="form-control" />
                                    <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class='col-sm-3'>
                            <div class="form-group">
                                Farm:
                            <select id="farm" class="form-control">
                                <option>A</option>
                                <option>B</option>
                                <option>C</option>
                                <option>D</option>
                                <option>E</option>
                                <option>F</option>
                                <option>G</option>
                            </select>
                            </div>
                        </div>

                        <div class='col-sm-3'>
                            <div class="form-group"><br/>
                                <div>
                                    <button type="button" class="btn btn-warning" id="createbutton">Search</button>
                                    <button type="button" class="btn btn-success" id="postDraw">Analytics</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class='col-sm-2'>
                                Download Data on
                            <div class='input-group date' id='datetimepicker1'>
                                    <input id="date_3" type='text' class="form-control" />
                                    <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
                                    </span>
                            </div>
                        </div>

                        <div class='col-sm-3'><br/>
                            <button type="button" class="btn btn-danger" id="button-postMilking">Download</button>
                        </div>
                    </div>

                    <div id="divTable" class="container">
                    </div>

                    <div class='col-sm-10'>
                      <div id="postcanvas"></div>
                    </div>
                </div>
            </div>
            <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <script>
        function logout(){
            localStorage.setItem("username","");
            localStorage.setItem("password","");
            window.location = "index.html";
        }

        var post_data;
        var columns = ['date', 'Total Scored', 'Teat Skin Condition (Abnormal %)', 'Teat Color (Abnormal %)', 'Swelling Near Teat Base (Abnormal %)',
        'Hardness at Teat End (Abnormal %)', 'Teat End Score (Abnormal %)', 'Open Lesion (Abnormal %)', 'Hemorrhage (Abnormal %)'];


        $("#createbutton").click(function createTable() {

            var date_1 = document.getElementById("date_1").value;
            console.log(date_1);

            var date_2 = document.getElementById("date_2").value;
            console.log(date_2);

            var farm = document.getElementById("farm").value;

            var username = localStorage.getItem("username");
            var password = localStorage.getItem("password");
            console.log(username+" "+password);

            var settings = {
                "async": false,
                "crossDomain": true,
                "url": "http://localhost:3000/post?date1="+date_1+"&date2="+date_2+"&farm="+farm,
                "method": "GET",
                "headers": {
                    'Content-Type' : 'application/x-www-form-urlencoded; charset=UTF-8',
                    "username": username,
                    "password": password

                }
            };

            var res=[];
            $.ajax(settings).done(function (response) {
                res = response;
            });
            console.log(res);


            if (res[0] == false){
                window.location = "index.html";
            }


            d3.json('../data/search/post_data.json', function (error,data) {


                document.getElementById("divTable").innerHTML = ""

                // Create table.
                console.log(res[1]);
                post_data = res[1];






                var post_data_summary = d3.nest()
                    .key(function (d){ return d.date;})
                    .rollup(function(v){ return {
                        Total_Scored: d3.sum(v, function(d) {return d.group_id;}),
                        Total_Skin_Condition_Abnormal: d3.sum(v, function(d){return d.skin_condition.LH != 'N' || d.skin_condition.LF != 'N' || d.skin_condition.RH != 'N' || d.skin_condition.RF != 'N'}),
                        Total_Color_Abnormal: d3.sum(v, function(d){return d.color.LH != 'N' || d.color.LF != 'N' || d.color.RH != 'N' || d.color.RF != 'N'}),
                        Total_Swelling_Abnormal: d3.sum(v, function(d){return d.swelling.LH != 'N' || d.swelling.LF != 'N' || d.swelling.RH != 'N' || d.swelling.RF != 'N'}),
                        Total_End_Score_Abnormal: d3.sum(v, function(d){return d.end_score.LH != 'N' || d.end_score.LF != 'N' || d.end_score.RH != 'N' || d.end_score.RF != 'N'}),
                        Total_Hardness_Abnormal: d3.sum(v, function(d){return d.hardness.LH != 'N' || d.hardness.LF != 'N' || d.hardness.RH != 'N' || d.hardness.RF != 'N'}),
                        Total_Open_Leison: d3.sum(v, function(d){return d.skin_condition.LH == 'OL' || d.skin_condition.LF == 'OL' || d.skin_condition.RH == 'OL' || d.skin_condition.RF == 'OL'}),
                        Total_Hemorrhage: d3.sum(v, function(d){return d.skin_condition.LH == 'H' || d.skin_condition.LF == 'H' || d.skin_condition.RH == 'H' || d.skin_condition.RF == 'H'}),
                        Percent_Skin_Condition_Abnormal: Math.round(d3.sum(v, function(d){return (d.skin_condition.LH != 'N' || d.skin_condition.LF != 'N' || d.skin_condition.RH != 'N' || d.skin_condition.RF != 'N') / d3.sum(v, function(d) {return d.group_id;}) }) *100),
                        Percent_Color_Abnormal: Math.round(d3.sum(v, function(d){return (d.color.LH != 'N' || d.color.LF != 'N' || d.color.RH != 'N' || d.color.RF != 'N') / d3.sum(v, function(d) {return d.group_id;}) }) *100),
                        Percent_Swelling_Abnormal: Math.round(d3.sum(v, function(d){return (d.swelling.LH != 'N' || d.swelling.LF != 'N' || d.swelling.RH != 'N' || d.swelling.RF != 'N') / d3.sum(v, function(d) {return d.group_id;}) }) *100),
                        Percent_End_Score_Abnormal: Math.round(d3.sum(v, function(d){return (d.end_score.LH != 'N' || d.end_score.LF != 'N' || d.end_score.RH != 'N' || d.end_score.RF != 'N') / d3.sum(v, function(d) {return d.group_id;}) }) *100),
                        Percent_Hardness_Abnormal: Math.round(d3.sum(v, function(d){return (d.hardness.LH != 'N' || d.hardness.LF != 'N' || d.hardness.RH != 'N' || d.hardness.RF != 'N') / d3.sum(v, function(d) {return d.group_id;}) }) *100),
                        Percent_Open_Leison: Math.round(d3.sum(v, function(d){return (d.skin_condition.LH == 'OL' || d.skin_condition.LF == 'OL' || d.skin_condition.RH == 'OL' || d.skin_condition.RF == 'OL') / d3.sum(v, function(d) {return d.group_id;}) }) *100),
                        Percent_Hemorrhage: Math.round(d3.sum(v, function(d){return (d.skin_condition.LH == 'H' || d.skin_condition.LF == 'H' || d.skin_condition.RH == 'H' || d.skin_condition.RF == 'H') / d3.sum(v, function(d) {return d.group_id;})}) *100)
                        // percent_good: d3.sum(v, function (d){ return d.Good;}) / d3.sum(v, function(d) {return d.Good + d.Bad;}),
                        // percent_bad: d3.sum(v, function (d){ return d.Bad;}) / d3.sum(v, function(d) {return d.Good + d.Bad;}),
                    };})
                    .entries(post_data);


                console.log(post_data_summary);

                var table = d3.select('#divTable').append('table').attr('class', 'blueTable').attr('border', 1);
                var thead = table.append('thead');
                var tbody = table.append('tbody');

                thead
                    .selectAll('th')
                    .data(columns)
                    .enter()
                    .append('th')
                    .text(function (column) { return column; });

                var rows = tbody.selectAll('tr')
                    .data(post_data_summary)
                    .enter()
                    .append('tr')


                var post_data_length = post_data_summary.length;
                console.log(post_data_length);


                for (var i = 0; i < post_data_length; i++){
                    var tr = tbody.append('tr');

                    var td = tr.append('td')
                    .text(post_data_summary[i].key);
                    var td = tr.append('td')
                    .text(post_data_summary[i].value.Total_Scored);
                    var td = tr.append('td')
                    .text(post_data_summary[i].value.Percent_Skin_Condition_Abnormal);
                    var td = tr.append('td')
                    .text(post_data_summary[i].value.Percent_Color_Abnormal);
                    var td = tr.append('td')
                    .text(post_data_summary[i].value.Percent_Swelling_Abnormal);
                    var td = tr.append('td')
                    .text(post_data_summary[i].value.Percent_End_Score_Abnormal);
                    var td = tr.append('td')
                    .text(post_data_summary[i].value.Percent_Hardness_Abnormal);
                    var td = tr.append('td')
                    .text(post_data_summary[i].value.Percent_Open_Leison);
                    var td = tr.append('td')
                    .text(post_data_summary[i].value.Percent_Hemorrhage);


                }


            });

        });
    </script>

    <!-- jQuery -->
    <script src="../vendor/jquery/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="../vendor/metisMenu/metisMenu.min.js"></script>

    <!-- DataTables JavaScript -->
    <script src="../vendor/datatables/js/jquery.dataTables.min.js"></script>
    <script src="../vendor/datatables-plugins/dataTables.bootstrap.min.js"></script>
    <script src="../vendor/datatables-responsive/dataTables.responsive.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="../dist/js/sb-admin-2.js"></script>

    <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
    <script src='http://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js'></script>
    <script src='http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js'></script>
    <script src='http://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/3.1.3/js/bootstrap-datetimepicker.min.js'></script>
    <script src= "../dist/js/index.js"></script>

    <!-- File Saver -->
    <script lang="javascript" src="../data/xlsx/dist/xlsx.full.min.js"></script>
    <script lang="javascript" src="../data/file-saver/FileSaver.min.js"></script>
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script> -->
    <script src="../data/scripts.js"></script>
    <!--chart js-->
    <script src="../dist/js/chart/utils.js" type="text/javascript"></script>
    <script src="../dist/js/chart/draw.js" type="text/javascript"></script>

    <!-- Page-Level Demo Scripts - Tables - Use for reference -->
    <!-- <script>
    $(document).ready(function() {
        $('#dataTables-example').DataTable({
            responsive: true
        });
    });
    </script> -->

</body>

</html>
